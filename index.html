<!DOCTYPE HTML PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN"
                    "http://www.w3.org/TR/html4/loose.dtd">
<html>
<head>
    <title></title>
    <script src="http://ajax.googleapis.com/ajax/libs/jquery/1.3/jquery.min.js"></script>
 
    <script type="text/javascript">

        var serviceUrl = "http://localhost:8000";

        function addIdentifier(textValue) {

            // create the new element via clone(), and manipulate it's ID using newNum value
            var newElem = $('#divToClone').find('.clonedInput').clone();
            newElem.find(".identifierInput").val(textValue);


            // insert the new element after the last "duplicatable" input field
            $('#identifiers').append(newElem);

            newElem.find('.btnDel').click(function() {
                newElem.remove();
            });
        }

        $(document).ready(function() {
            $('#btnAdd').click(function() {
                addIdentifier();
            });
 
            $('#btnLoad').click(function() {
                $.ajax({
                    type: "GET",
                    url: serviceUrl + "/id/" + $('#resourceTypeLoad').val() + "?id=" + $('#identifierLoad').val(),
                    dataType: 'json',
                    contentType: "application/jsonp",
                    success: function(data) {
                        $.ajax({
                            type: "GET",
                            url: serviceUrl + "/ids/" + data.resourceType + "/" + data.resourceName,
                            dataType: 'json',
                            contentType: "application/jsonp",
                            success: function(data) {
                                $('#resourceType').val(data.resourceType);
                                $('#resourceName').val(data.resourceName);
                                $('#resourceUri').val(data.resourceURI);

                                $('#identifiers').empty();
                                for(i in data.identifiers){
                                    addIdentifier(data.identifiers[i])
                                }
                            }
                        });
                    }
                });
            });

            $('#btnSave').click(function() {
                var json = {
                    resourceType : $('#resourceType').val(),
                    resourceName : $('#resourceName').val(),
                    resourceURI : $('#resourceUri').val(),
                    identifiers : []
                }

                $('.identifierInput').each(function(){
                    json.identifiers.push($(this).val())
                });

                $.ajax({
                    type: "PUT",
                    url: serviceUrl + "/ids/" + json.resourceType + "/" + json.resourceName,
                    dataType: 'json',
                    contentType: "application/json",
                    data: JSON.stringify(json),
                    success: function(data) {
                        alert("ok");
                    },
                    error: function(jqXHR, textStatus, errorThrown) {
                        alert("ERROR: " + jqXHR.responseText);
                    }
                });
            });
        });
    </script>
</head>
 
<body>
 
<form id="myForm">
    Resource Name: <input type="text" name="resourceName" id="resourceName" />
    <br/>
    Resource URI: <input type="text" name="resourceUri" id="resourceUri" />
    <br/>
    Resource Type: <select name="resourceType" id="resourceType" >
                      <option value="CODE_SYSTEM">CODE_SYSTEM</option>
                      <option value="CODE_SYSTEM_VERSION">CODE_SYSTEM_VERSION</option>
                      <option value="VALUE_SET">VALUE_SET</option>
                   </select>
    <br/>
    Identifiers:
    <div id="identifiers"></div>

 
    <div>
        <input type="button" id="btnAdd" value="Add Identifier" />
        
    </div>
    <input type="button" id="btnSave" value="save" />
    <input type="button" id="btnLoad" value="load" />
    Identifier: <input type="text" name="identifierLoad" id="identifierLoad" />
    Resource Type:  <select name="resourceTypeLoad" id="resourceTypeLoad" >
                        <option value="CODE_SYSTEM">CODE_SYSTEM</option>
                        <option value="CODE_SYSTEM_VERSION">CODE_SYSTEM_VERSION</option>
                        <option value="VALUE_SET">VALUE_SET</option>
                    </select>
</form>
 
    <div id="divToClone" style='visibility:hidden'>
         <div style="margin-bottom:4px;" class="clonedInput">
            Identifier: <input type="text" class="identifierInput" />
            <input type="button" value="Remove Identifier" class="btnDel" />
        </div>
    </div

</body>
</html>